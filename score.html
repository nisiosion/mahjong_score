<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>麻雀成績（入力版）</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 16px;
      background: #f5f5f5;
    }
    input {
      margin: 2px;
      width: 50px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    .summary {
      margin-top: 16px;
      background: #fff;
      padding: 12px;
    }
    .row-input {
      margin-bottom: 8px;
      background: #fff;
      padding: 8px;
    }
  </style>
</head>
<body>

<h1>麻雀 成績管理（入力版）</h1>

<div class="row-input">
  <label>プレイヤー1: <input id="p1" /></label>
  <label>着順: <input type="number" id="r1" min="1" max="4" /></label>
  <label>プレイヤー2: <input id="p2" /></label>
  <label>着順: <input type="number" id="r2" min="1" max="4" /></label><br>
  <label>プレイヤー3: <input id="p3" /></label>
  <label>着順: <input type="number" id="r3" min="1" max="4" /></label>
  <label>プレイヤー4: <input id="p4" /></label>
  <label>着順: <input type="number" id="r4" min="1" max="4" /></label><br>
  <button id="addBtn">追加</button>
</div>

<table>
  <thead>
    <tr>
      <th>日時</th>
      <th>プレイヤー</th>
      <th>着順</th>
    </tr>
  </thead>
  <tbody id="resultTable"></tbody>
</table>

<div class="summary" id="summary"></div>

<script>
  const resultTable = document.getElementById("resultTable");
  const summary = document.getElementById("summary");

  // サンプルデータ
  let games = [
    { date: "2/2 18:28:35", players: ["A", "B", "C", "D"], ranks: [4,2,3,1] }
  ];

  function render() {
    resultTable.innerHTML = "";
    games.forEach(g => {
      g.players.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${g.date}</td><td>${p}</td><td>${g.ranks[i]}</td>`;
        resultTable.appendChild(tr);
      });
    });

    // 集計
    const allRanks = games.flatMap(g => g.ranks);
    const total = allRanks.length / 4;
    const avgRank = total ? (allRanks.reduce((s,v)=>s+v,0)/total).toFixed(2) : "-";

    summary.innerHTML = `<div>半荘数：${total}</div><div>平均順位：${avgRank}</div>`;
  }

  render();

  document.getElementById("addBtn").addEventListener("click", () => {
    const p1 = document.getElementById("p1").value.trim();
    const p2 = document.getElementById("p2").value.trim();
    const p3 = document.getElementById("p3").value.trim();
    const p4 = document.getElementById("p4").value.trim();
    const r1 = parseInt(document.getElementById("r1").value);
    const r2 = parseInt(document.getElementById("r2").value);
    const r3 = parseInt(document.getElementById("r3").value);
    const r4 = parseInt(document.getElementById("r4").value);

    if (!p1 || !p2 || !p3 || !p4 || !r1 || !r2 || !r3 || !r4) {
      alert("全て入力してください");
      return;
    }

    const newGame = {
      date: new Date().toLocaleString(),
      players: [p1,p2,p3,p4],
      ranks: [r1,r2,r3,r4]
    };

    games.push(newGame);
    render();

    // 入力欄クリア
    document.getElementById("p1").value = "";
    document.getElementById("p2").value = "";
    document.getElementById("p3").value = "";
    document.getElementById("p4").value = "";
    document.getElementById("r1").value = "";
    document.getElementById("r2").value = "";
    document.getElementById("r3").value = "";
    document.getElementById("r4").value = "";
  });
</script>

</body>
</html>
